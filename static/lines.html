<!DOCTYPE html>
<meta charset="utf-8">
<style>
 .rank {
  fill: none;
  stroke-width: 3;
}

.ranknr {
    fill:black;
}
</style>
<body>
<script src="/static/js/d3.v3.min.js"></script>
<script>


d3.json("http://florisla.pythonanywhere.com/ranking/data", function(ranks) {
    ranking = ranks;
    draw();
})

function draw() {

var positions = [];
var players = [];

for (var player in ranking) {
    ranks = ranking[player];
    player_positions = [];
    for (var i=0; i<ranks.length; i++)
    {
        position = [i, ranks[i] ];
        player_positions.push(position);
    };

    player_ranks = {};
    player_ranks['player'] = player;
    player_ranks['positions'] = player_positions;
    positions.push(player_ranks);
    players.push([player_positions[player_positions.length-1][1], player]);
};

game_count = ranks.length;
player_count = positions.length;
var width = 600;
height = 450;

var color = d3.scale.category20();

var svg = d3.select("body")
    .append("svg:svg")
    .attr("width", width)
    .attr("height", height)

var line = d3.svg.line()
    .x(function(d){return 20 + d[0] * (width-100)/game_count;})
    .y(function(d){return 10 + d[1] * height/player_count;})
    .interpolate('monotone');

var rank_lines = svg.selectAll('.rank')
   .data(positions)
   .enter()
   .append('path')
   .attr('class', 'rank')
   .attr('stroke', function(d,i) {return color(i); } )
   .attr("d", function(d) {return line(d.positions);});

rank_nrs = []
for (var i=1; i<=player_count; i++)
{
    rank_nrs.push(i);
};

var rank_nr_labels = svg.selectAll('.ranknr')
    .data(rank_nrs)
    .enter()
    .append('text')
    .attr("x", 2)
    .attr("y", function(d) { return -2 + d * height/player_count; } )
    .text(function(d) { return d; } );

var player_labels = svg.selectAll('.ranknr')
    .data(players)
    .enter()
    .append('text')
    .attr("x", width-100)
    .attr("y", function(d) { return 14 + d[0] * height/player_count; } )
    .attr('stroke', function(d,i) {return color(i); } )
    .text(function(d) { return d[1]; } );
}

</script>